<div class="container" [class.blurred]="showResults">
  <nav class="toolbar">
    <div class="toolbar-brand">twype</div>

    <div class="toolbar-center">
      <div class="duration-pills">
        <button [class.active]="selectedDuration === 15" [disabled]="hasStarted" (click)="setDuration(15)">15</button>
        <button [class.active]="selectedDuration === 30" [disabled]="hasStarted" (click)="setDuration(30)">30</button>
        <button [class.active]="selectedDuration === 60" [disabled]="hasStarted" (click)="setDuration(60)">60</button>
      </div>
    </div>

    <div class="toolbar-stats">
      <div class="toolbar-stat">
        <span class="toolbar-stat-value" [class.warning]="isWarning">{{ timeLeft }}</span>
        <span class="toolbar-stat-label">sec</span>
      </div>
      <div class="toolbar-divider"></div>
      <div class="toolbar-stat">
        <span class="toolbar-stat-value">{{ liveWpm }}</span>
        <span class="toolbar-stat-label">wpm</span>
      </div>
    </div>
  </nav>

  <div class="text-display">
    <div class="progress-bar" [style.width.%]="progress"></div>
    @for (word of testWords; track $index; let wordIdx = $index) {
    <span class="word">
      @for (char of word.chars; track $index) {
      <span class="char" [class]="char.status">{{ char.char }}</span>
      }
    </span>
    @if (wordIdx < testWords.length - 1) { @let spaceIdx=getSpaceIndex(wordIdx); @if (spaceIdx < flatChars.length &&
      flatChars[spaceIdx].isSpace) { <span class="char space" [class]="flatChars[spaceIdx].status">&nbsp;</span>
      }
      }
      }
  </div>

  @if (!hasStarted) {
  <div class="instructions">press any key to begin</div>
  }
</div>

@if (showResults) {
<div class="results-overlay">
  <div class="results">
    <div class="results-header">complete</div>

    <div class="results-main">
      <span class="results-wpm">{{ netWpm }}</span>
      <span class="results-unit">wpm</span>
    </div>

    <div class="results-details">
      <div class="results-detail">
        <span class="detail-value">{{ rawWpm }}</span>
        <span class="detail-label">raw</span>
      </div>
      <div class="results-detail">
        <span class="detail-value">{{ accuracy }}%</span>
        <span class="detail-label">acc</span>
      </div>
      <div class="results-detail">
        <span class="detail-value">{{ incorrectChars }}</span>
        <span class="detail-label">err</span>
      </div>
      <div class="results-detail">
        <span class="detail-value">{{ totalCharacters }}</span>
        <span class="detail-label">chr</span>
      </div>
    </div>

    <div class="chart-container">
      <canvas #wpmChart></canvas>
    </div>

    <button class="restart-btn" (click)="restart()">again</button>
  </div>
</div>
}